<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Yunze Li">





<title>Dependency Injection | Yunze Li</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 4.2.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Yunze Li</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Yunze Li</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Dependency Injection</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Yunze Li</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">2020-02-28
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h2 id="What-is-Dependency-Injection"><a href="#What-is-Dependency-Injection" class="headerlink" title="What is Dependency Injection"></a>What is Dependency Injection</h2><p>Before answering this question, a better question to ask might be:</p>
<h3 id="What-is-dependency"><a href="#What-is-dependency" class="headerlink" title="What is dependency"></a>What is <strong>dependency</strong></h3><p>To answer this question, let’s take a look at this Kotlin code here:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleFeature</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="keyword">val</span> businessLogicDelegate: BusinessLogicDelegate,</span><br><span class="line">    <span class="keyword">val</span> validator: Validator,</span><br><span class="line">    <span class="keyword">val</span> listener: Listener</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> helper = Helper()</span><br><span class="line">        <span class="keyword">if</span> (validator.validate()) &#123;</span><br><span class="line">            businessLogicDelegate.doSomething(helper, listener)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is a very common secenario in real life: I have a class and serveral parameters in its constructor, I need call some methods of those parameters inside this class. At the same time, I also need initialize a helper class inside and use it. In this case, both the parameters and helper class will be considered as the <code>Dependency of SimplyFeature class</code>. Cause this <code>SimpleFeature</code> needs “<em>depend on</em>“ something to finsh its own job. In another word, if any class’s method is called inside a class A, those class will be considered as <em>A’s dependency</em>.</p>
<h3 id="So-now-I-know-dependency-what-is-dependency-injection"><a href="#So-now-I-know-dependency-what-is-dependency-injection" class="headerlink" title="So now I know dependency, what is dependency injection?"></a>So now I know dependency, what is <strong>dependency injection</strong>?</h3><p>Let’s look back to this code again:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleFeature</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="keyword">val</span> businessLogicDelegate: BusinessLogicDelegate,</span><br><span class="line">    <span class="keyword">val</span> validator: Validator,</span><br><span class="line">    <span class="keyword">val</span> listener: Listener</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> helper = Helper()</span><br><span class="line">        <span class="keyword">if</span> (validator.validate()) &#123;</span><br><span class="line">            businessLogicDelegate.doSomething(helper, listener)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There are two main issues in this code block:</p>
<ol>
<li>Inside the doSomeThing(), we need to initialize a <code>Helper</code> class to help finishing business logic. This can work for sure, but if this helper needs to be a static class, or I need to using a <code>Signleton</code> helper class, here, how can I use it?</li>
<li>When writing unit test with <a href="https://site.mockito.org/" target="_blank" rel="noopener">Mockito</a> or <a href="https://mockk.io/" target="_blank" rel="noopener">Mockk</a>, a common way is passing in a “<em>mock</em>“ instance and testing if the expected method of this mock is called with correct parameter. But how can we pass in the mock of Helper class if the <code>new</code> operator is called inside?</li>
</ol>
<p>To solve these problems, what can we do? Just simply pass a helper instance in the constructor so it can become the dependency of SimpleFeature as well! The constructor will look like this:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleFeature</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="keyword">val</span> businessLogicDelegate: BusinessLogicDelegate,</span><br><span class="line">    <span class="keyword">val</span> validator: Validator,</span><br><span class="line">    <span class="keyword">val</span> listener: Listener,</span><br><span class="line">    <span class="keyword">val</span> helper: Helper</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (validator.validate()) &#123;</span><br><span class="line">            businessLogicDelegate.doSomething(helper, listener)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now it looks great! I can pass in any Helper class and also mocking it and do the unit test! Nice! Now we can make a conclusion here:</p>
<blockquote>
<p>Dependency Injection means:<br><strong>Passing the dependency into the class and use it</strong></p>
</blockquote>
<p>One thing need to mention here is: passing through class’s constructor is only one of the way to do DI. More details about this concept can be find <a href="https://en.wikipedia.org/wiki/Dependency_injection" target="_blank" rel="noopener">here</a>.</p>
<h3 id="How-can-I-use-dependencies-injection"><a href="#How-can-I-use-dependencies-injection" class="headerlink" title="How can I use dependencies injection?"></a>How can I use dependencies injection?</h3><p>To use dependencies injection effectively, let me introduce this super-useful library here:</p>
<p><img src="https://i1.wp.com/codingsonata.com/wp-content/uploads/2017/12/Android-dagger-2.png?resize=300%2C208" alt="alt text" title="Dagger"></p>
<p>This <a href="https://dagger.dev/" target="_blank" rel="noopener">Dagger 2</a> library are powerful for android application dependency injection, by using this, all we need to do it’s define each class’s dependency list and the scope to use it. All other stuff will be handled by this library automatically and anonymously. So how to use it? First, we need to have a module class:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MainModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providesBusinessLogicDelegate</span><span class="params">(businessLogicDelegateImpl: <span class="type">BusinessLogicDelegateImpl</span>)</span></span>: BusinessLogicDelegate</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providesValidator</span><span class="params">(validatorImpl: <span class="type">ValidatorImpl</span>)</span></span>: Validator</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providesListener</span><span class="params">(listenerImpl: <span class="type">ListenerImpl</span>)</span></span>: Listener</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providesHelper</span><span class="params">(helperImpl: <span class="type">HelperImpl</span>)</span></span>: Helper</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>What is this <strong>Module</strong> use for? Basically this is the place you want dagger helps you to initialize all your dependency. There are two ways to initial dependency in dagger, one is through <strong>@Bind</strong> annotation and another is <strong>@Provides</strong>. In here I’m using @Binds since it’s much simpler if all dependencies has implement an interface.</p>
<p>Then we need another class which is called componenet class:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> (modules = [MainModule::<span class="class"><span class="keyword">class</span>])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MainComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">MainActivity</span>)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(feature: <span class="type">SimpleFeature</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Inside this <strong>Component</strong>, the inject() method defines “where those dependencies should be injected to”. And following the <strong>@Component</strong> annotation we can declare all modules that can be included, so we can inject multiple module’s dependencies inside one single class that called by inject() method.</p>
<p>So far so good! After create these two classes above, we defined <code>What is the dependency</code> and <code>Where should we inject into</code>. Now the final step will be refactor our <strong>SimpleFeature</strong> class:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleFeature</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="keyword">val</span> businessLogicDelegate: BusinessLogicDelegate,</span><br><span class="line">    <span class="keyword">val</span> validator: Validator,</span><br><span class="line">    <span class="keyword">val</span> listener: Listener,</span><br><span class="line">    <span class="keyword">val</span> helper: Helper</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doSomeThing</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (validator.validate()) &#123;</span><br><span class="line">            businessLogicDelegate.doSomething(helper, listener)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since all parameters inside the constructor are initialized in module class and the injection of this feature class also declared in component class, the only change needed in here is add <strong>@Inject</strong> annotation before <code>constructor</code>, then dagger knows that all parameters can be find in module and injected by component magically.</p>
<p>Done! Now enjoy inject any dependency you want!</p>
<p>Now there are still some notes worth mention here:</p>
<ul>
<li><p>What we using here is just a very brief introduction of Dagger, it has a lot powerful methods and tools that worth to try and play with it. More detail should be found in <a href="https://dagger.dev/" target="_blank" rel="noopener">here</a></p>
</li>
<li><p>One of the very useful feature of Dagger is <strong>@Scope</strong> annotation. It can be used in complicated structured project to define different scope for different dependencies to access. This part will be added in future as a follow-up of our DI topic.</p>
</li>
<li><p>The main purpose of DI is align with one of the basic <a href="https://en.wikipedia.org/wiki/SOLID" target="_blank" rel="noopener">SOLID</a> principle in softwate development, which is know as <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank" rel="noopener">Dependency Inversion Rules</a>. This principle states:</p>
<ul>
<li>High-level Module should not depends on low-level module, both should depend on abstractions (interface);</li>
<li>Abstractions should not depend on details. Details (concrete implementation) should depends on abstraction.</li>
</ul>
</li>
<li><p>We will cover all these principles one by one in future, they are very important in industrial software development world.</p>
</li>
<li><p>Although there are tons of advantages in DI, but it has its limit or disadvantage for sure. For example, when dependency is missing, it’s hard to find out which dependency is missing by checking the build output. So at this time, log is very useful to check.</p>
</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Yunze Li</span>
                    </p>
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Android/"># Android</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2020/04/28/cleanCode/">Clean Code Summary</a>
            
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Yunze Li | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
